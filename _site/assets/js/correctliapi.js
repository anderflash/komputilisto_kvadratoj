(function($){$.fn.replaceText=function(b,a,c){return this.each(function(){var f=this.firstChild,g,e,d=[];if(f){do{if(f.nodeType===3){g=f.nodeValue;e=g.replace(b,a);if(e!==g){if(!c&&/</.test(e)){$(f).before(e);d.push(f)}else{f.nodeValue=e}}}}while(f=f.nextSibling)}d.length&&$(d).remove()})}})(jQuery);(function(jQuery){jQuery.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":"\"",",":"<",".":">","/":"?","\\":"|"}};function keyHandler(handleObj){if(typeof handleObj.data!=="string"){return;}
var origHandler=handleObj.handler,keys=handleObj.data.toLowerCase().split(" ");handleObj.handler=function(event){if(this!==event.target&&(/textarea|select/i.test(event.target.nodeName)||event.target.type==="text")){return;}
var special=event.type!=="keypress"&&jQuery.hotkeys.specialKeys[event.which],character=String.fromCharCode(event.which).toLowerCase(),key,modif="",possible={};if(event.altKey&&special!=="alt"){modif+="alt+";}
if(event.ctrlKey&&special!=="ctrl"){modif+="ctrl+";}
if(event.metaKey&&!event.ctrlKey&&special!=="meta"){modif+="meta+";}
if(event.shiftKey&&special!=="shift"){modif+="shift+";}
if(special){possible[modif+special]=true;}else{possible[modif+character]=true;possible[modif+jQuery.hotkeys.shiftNums[character]]=true;if(modif==="shift+"){possible[jQuery.hotkeys.shiftNums[character]]=true;}}
for(var i=0,l=keys.length;i<l;i++){if(possible[keys[i]]){return origHandler.apply(this,arguments);}}};}
jQuery.each(["keydown","keyup","keypress"],function(){jQuery.event.special[this]={add:keyHandler};});})(jQuery);(function($){$.fn.correctli=function(options){var defaults={keyCombination:'none',minimumCharacters:"1",maximumCharacters:"100",language:"en",apiKey:"1c35824182c60906ee6ed15d8f87bc74",url:'http://correct.li/api',text:{typeCorrectedTextButton:"type corrected text above and click enter to send"}};var options=$.extend(defaults,options);function correctli_createBox(ele,e){correctliBox='<div class="correctliBox '+options.extraClass+'">'+'<form action="http://correct.li/api/push?api='+options.apiKey+'&language='+options.language+'" method="post">'+'<input type="text" name="word" class="correctliCorrectWord"/>'+'<input type="hidden" name="wrongWord" value="" class="correctliWrongWord" />'+'<input type="submit" style="display: none;" value="submit" />'+'<button type="submit">'+options.text.typeCorrectedTextButton+'</button>'+'</form>'+'</div>';$('body').append(correctliBox);}
function correctli_getSelection(){if(window.getSelection){selectionTxt=window.getSelection();}
else if(document.getSelection){selectionTxt=document.getSelection();}
else if(document.selection){selectionTxt=document.selection.createRange().text;}
return selectionTxt;}
function correctli_getRangeObject(selectionObject){if(selectionObject.getRangeAt)
return selectionObject.getRangeAt(0);else{var range=document.createRange();range.setStart(selectionObject.anchorNode,selectionObject.anchorOffset);range.setEnd(selectionObject.focusNode,selectionObject.focusOffset);return range;}}
function correctli_getElementPosition(selectionText){var range=correctli_getRangeObject(selectionText);var dummy=document.createElement("span");newRange=document.createRange();newRange.setStart(selectionText.focusNode,range.endOffset);newRange.insertNode(dummy);var x=$(dummy).offset().left,y=$(dummy).offset().top;dummy.parentNode.removeChild(dummy);return{x:x,y:y}}
function correctli_formWindow(){if($('#correctli_tmpForm').length==0)
$('body').append('<div id="correctli_tmpForm" style="display: none;"></div>');$('#correctli_tmpForm').html($('.correctliBox').html());$('#correctli_tmpForm form').attr("target","_blank");$('#correctli_tmpForm form').trigger('submit');}
function correctli_findHash(){if(window.isWordChecked)return;if(window.location.hash.indexOf("correctli_")!=-1){var hash=window.location.hash.replace("#","");window.isWordChecked=true;$.ajax({type:'POST',url:options.url+'/get?api='+options.apiKey+'&language='+options.language+'&operation=getWordById',data:{action:'getWordById',params:{id:hash.replace("correctli_","")},url:document.location.href},success:function(data){if(data.message!=""){alert(data.message);}
if(data.type!="success"){return true;}
$('body *').replaceText(data.wordWrong,'<span class="correctli_wordWrong" id="'+hash+'">'+data.wordWrong+'</span>');window.location.hash='#';window.location.hash=hash;$('body').append('<ol class="correctli_wordCorrect">'+data.wordCorrect+'</ol>');$('.correctli_wordWrong').hover(function(e){if($(this).hasClass("active"))return true;var correctli_wordCorrectBox=$('.correctli_wordCorrect');var coordinates=correctli_countCoordinates(correctli_wordCorrectBox,e.pageX,e.pageY);correctli_wordCorrectBox.css({top:coordinates.y,left:coordinates.y,display:"block"});},function(e){$('.correctli_wordCorrect').css({display:"none"});});},dataType:'json',crossDomain:true});}}
function correctli_countCoordinates(ele,x,y){if((ele.outerWidth()+x)>=$(document).width()){x=x-((ele.outerWidth()+x)-$(document).width());}
var top=y-(ele.outerHeight()+10);if(top<0){top=y+10;}
return{x:x,y:top};}
function correctli_init(ele){if($('.correctliBox').length==0){correctli_createBox(ele);window.isPressedEnter=false;$('body').append('<style type="text/css">.correctliBox{color:#000;padding:5px;width:201px;height:124px;font-family:Helvetica,Arial,sans-serif;font-size:12px;position:absolute;display:none;background:url(http://correct.li/images/api/bg-wrong.png) no-repeat center center;text-align:center;z-index:9999;}.correctliBox.send{text-shadow:none;text-align:center;color:#fff;height:129px;line-height:140%;width:202px;padding-left:5px;padding-right:5px;font-size:13px;font-weight:bold;}.correctliBox.send .messageType-error{background:none repeat scroll 0 0 #ed3800;border-radius:3px 3px 3px 3px;color:#fd9a7c;display:block;font-size:11px;font-weight:bold;margin:8px 5px 5px;padding:8px;text-transform:uppercase;}.correctliBox.send .messageType-success{background:none repeat scroll 0 0 #AFF000;border-radius:3px 3px 3px 3px;color:#688F00;display:block;font-size:11px;font-weight:bold;margin:8px 5px 5px;padding:8px;text-transform:uppercase;}.correctliBox.send form{display:none;}.correctliBox input[type="text"]{margin-bottom:2px;margin-top:2px;background:url(http://correct.li/images/api/bg-input.png);width:142px;height:44px;line-height:44px;padding-left:5px;padding-right:43px;border:3px solid #cdcdcd;border-radius:3px;}.correctliBox input[type="text"]:focus{border:3px solid #fe7800;}.correctliBox button{background:url(http://correct.li/images/api/arrow-up.png) no-repeat scroll 10px 12px #FE7800;border:0 none;border-radius:0 0 3px 3px;color:#FFFFFF;cursor:pointer;font-family:Arial,sans-serif;font-size:11px;height:37px;margin-top:-5px;padding:2px 5px 5px 30px;line-height:16px;text-align:left;text-transform:uppercase;width:196px;}.correctli_wordWrong{display:inline;border-radius:3px 3px 3px 3px;color:#fff !important;background:#FF3C00;color:#FFFFFF;text-shadow:0 1px 0 rgba(0,0,0,0.5);}.correctli_wordCorrect{display:none;position:absolute;z-index:1000;width:300px;padding:10px;color:#fff !important;border-radius:5px;text-shadow:0 -1px 0 rgba(0,0,0,0.25);box-shadow:0 1px 0 rgba(255,255,255,0.2) inset,0 1px 2px rgba(0,0,0,0.05);border-width:1px;border-style:solid;list-style:none;background-color:#75a926;background-image:-moz-linear-gradient(top,#8dc642,#75a926);background-image:-ms-linear-gradient(top,#8dc642,#75a926);background-image:-webkit-gradient(linear,0 0,0 100%,from(#8dc642),to(#75a926));background-image:-webkit-linear-gradient(top,#8dc642,#75a926);background-image:-o-linear-gradient(top,#8dc642,#75a926);background-image:linear-gradient(top,#8dc642,#75a926);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#8dc642\',endColorstr=\'#75a926\',GradientType=0);border-color:#8dc642 #8dc642 #75a926;border-color:rgba(0,0,0,0.1) rgba(0,0,0,0.1) rgba(0,0,0,0.25);filter:progid:dximagetransform.microsoft.gradient(enabled=false);}.correctli_wordCorrect li{padding:5px;}.correctli_button{cursor:pointer;}#correctli_buttonText{color:#000;border-radius:5px;background:#fff;padding:10px;position:absolute;z-index:20;border:1px dashed #b5b5b5;width:300px;}</style>');$('.correctliBox form').on('submit',function(e){if(window.isPressedEnter)return false;else window.isPressedEnter=true;var thisEl=this;$(thisEl).append('<input name="url" value="'+document.location.href+'" type="hidden" />');if($('input.correctliWrongWord',this).val()!=$('input.correctliCorrectWord',this).val()){
  if (navigator.userAgent.match(/msie|trident|opera/i) )
  //if($.browser.opera||$.browser.msie)
  {
	$(thisEl).append('<input name="html" value="1" type="hidden" />');
	correctli_formWindow();
	window.isPressedEnter=false;
	return false;
  }
$.ajax({type:'POST',url:options.url+'/push?api='+options.apiKey+'&language='+options.language,data:$(this).serialize(),success:function(data){$(thisEl).parent().addClass("send");$(thisEl).parent().append('<span class="sentText messageType-'+data.type+'">'+data.message+'</span>');window.isPressedEnter=false;},dataType:'json',crossDomain:true});}
$('input[name=url],input[name=html]',this).remove();return false;});$(document).keyup(function(e){if(e.keyCode==27){$('.correctliBox').stop(true,true).fadeOut('fast');}});$(document).mousedown(function(e){if($(e.target).closest('.correctliBox').length)
return;$('.correctliBox').stop(true,true).fadeOut('fast');});}
if(options.keyCombination=='none'){$(ele).mouseup(function(e){if($(e.target).closest('.correctliBox').length){return;}
correctli_run(this,e);});}else{$(ele).attr("tabindex","0").bind('keydown',options.keyCombination,function(e){correctli_run('body',null);return false;});}}
function correctli_run(obj,e){$('.correctliBox').removeClass("send");$('.correctliBox .sentText').remove();var selectionText=correctli_getSelection();var selectionText_copy=selectionText;if(selectionText!=''&&selectionText.toString().length>=parseInt(options.minimumCharacters)&&selectionText.toString().length<=parseInt(options.maximumCharacters)){correctliBoxEle=$('body').find('.correctliBox');var position=correctli_getElementPosition(selectionText);var coordinates=correctli_countCoordinates(correctliBoxEle,position.x,position.y);correctliBoxEle.css({top:coordinates.y,left:coordinates.x});correctliBoxEle.stop(true,true).fadeIn('fast');$('input.correctliCorrectWord').val(selectionText_copy.toString());$('input.correctliWrongWord').val(selectionText_copy.toString());}}
function correctli_replaceButton(){if($('.correctli_button').length>0){$('.correctli_button').on("click",function(){window.open('http://correct.li/'+options.language+'/api/using?api='+options.apiKey+'&url='+escape(document.location.href),'correctliinfo','scrollbars=no,menubar=no,height=300,width=500,resizable=yes,toolbar=no,status=no');});}}
correctli_replaceButton();correctli_findHash();return correctli_init($(this));}})(jQuery);